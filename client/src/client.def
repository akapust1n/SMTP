autogen definitions fsm;

method = callout;
type = reent;
cookie = "const char *cmd";
cookie = "void *state";

prefix = client_fsm;

state =	state_ready_to_send_ehlo,
	state_ehlo_sent,
	state_use_helo,
	state_helo_sent,
	state_ready_to_send_mail,
	state_mail_sent,
	state_ready_to_send_rcpt,
	state_rcpt_sent,
	state_recpt_check,
	state_ready_to_send_data,
	state_data_sent,
	state_ready_to_send_message_body,
	state_message_body_sent,
	state_quit,
	state_server_error;
	
event = event_connected,
	event_send_ehlo,
	event_got_ehlo_response,
	event_ehlo_not_supported,
	event_send_helo,
	event_got_helo_response,
	event_send_mail_from,
	event_send_rcpt_to,
	event_got_another_rcpt,
	event_all_rcpt_sent,
	event_send_data,
	event_ready_to_transfer_message_body,
	event_send_message_body,
	event_send_quit,
	event_server_accept;

transition = { tst = init; tev = event_connected; next = state_connected; },
{ tst = state_connected; tev = event_send_ehlo; next = state_ehlo_sent; },
{ tst = state_ehlo_sent; tev = event_got_ehlo_response; next = state_ready_to_send_mail; },
{ tst = state_ehlo_sent; tev = event_ehlo_not_supported; next = state_use_helo; },
{ tst = state_use_helo; tev = event_send_helo; next = state_helo_sent; },
{ tst = state_helo_sent; tev = event_got_helo_response; next = state_ready_to_send_mail; },
{ tst = state_ready_to_send_mail; tev = event_send_mail_from; next = state_mail_sent; },
{ tst = state_mail_sent; tev = event_server_accept; next = state_ready_to_send_rcpt; },
{ tst = state_ready_to_send_rcpt; tev = event_send_rcpt_to; next = state_rcpt_sent; },
{ tst = state_rcpt_sent; tev = event_server_accept; next = state_rcpt_check; },
{ tst = state_rcpt_check; tev = event_got_another_rcpt; next = state_ready_to_send_rcpt; },
{ tst = state_rcpt_check; tev = event_all_rcpt_sent; next = state_ready_to_send_data; },
{ tst = state_ready_to_send_data; tev = event_send_data; next = state_data_sent; },
{ tst = state_data_sent; tev = event_ready_to_transfer_message_body; next = state_ready_to_send_message_body; },
{ tst = state_ready_to_send_message_body; tev = event_send_message_body; next = state_message_body_sent; },
{ tst = state_message_body_sent; tev = event_server_accept; next = state_quit; },
{ tst = state_quit; tev = event_send_quit; next = done; };
